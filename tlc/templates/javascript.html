{% load staticfiles %}

<!--This code was previously with imports and meta links -->

<!--------------------------------------------------------->

<script src="{% static "js/jquery-2.2.3.min.js" %}"></script>
<script src="{% static "js/lightbox-plus-jquery.min.js" %}"></script>

<!-- Owl-Carousel-JavaScript -->
<script src="{% static "js/owl.carousel.js" %}"></script>
<script>
   $(document).ready(function() {
    $("#owl-demo").owlCarousel ({
      items : 4,
      lazyLoad : true,
      autoPlay : true,
      pagination : true,
    });
   });
</script>
<!-- Owl-Carousel-JavaScript -->

<!-- flexSlider -->
<script defer src="{% static "js/jquery.flexslider.js" %}"></script>
<script type="text/javascript">
   $(window).load(function(){
     $('.flexslider').flexslider({
    animation: "slide",
    start: function(slider){
      $('body').removeClass('loading');
    }
     });
   });

</script>
<!-- flexSlider -->


<!-- Move-top-scrolling -->
<script type="text/javascript" src="{% static "js/move-top.js" %}"></script>
<script type="text/javascript" src="{% static "js/easing.js" %}"></script>

<!-- Move-top-scrolling -->


<!-- Calendar -->
<link rel="stylesheet" href="{% static "css/jquery-ui.css" %}" />
<script src="{% static "js/jquery-ui.js" %}"></script>
<script>
  $(function() {
    $( "#datepicker,#datepicker1,#datepicker2,#datepicker3" )
      .datepicker({minDate: '+30D',maxDate: '+45D'});
  });
</script>
<!-- Calendar -->


<script>
   var cities = [
    {value:"1", label:"Buenos Aires"},
    {value:"1", label:"Buenos B"},
   ]
</script>


<script>
  $(document).ready(function() {

    $.get( "/rest/tlc/citys/autocomplete_search/?term=")
      .done(function( data ) {
        $("#fromName").autocomplete({
          source: data,
          focus: function (event, ui) {
                event.preventDefault();
                $("#fromName").val(ui.item.label);
                $("#from").val(ui.item.id)
            },
        });
      });

    $.get( "/rest/tlc/citys/autocomplete_search/?term=")
      .done(function( data ) {
        $("#toName").autocomplete({
          source: data,
          focus: function (event, ui) {
            event.preventDefault();
            $("#toName").val(ui.item.label);
            $("#to").val(ui.item.id)
          },
        });
      });


    {% if list_travels %}
      $(document).ready(function () {
      // Handler for .ready() called.
      $('html, body').animate({
          scrollTop: $('#contact').offset().top
      }, 'slow');
      });
    {% endif %}




    //calling the api with do_search and modifying the DOM on the fly
    {% load filters %}
    const Item = ({ departure, arrival, price }) => `
      <div class="panel-body">
        <ul>
          <li>
            <div class="grey">
              <div>
                <span>Departure: {{departure}}</span>
              </div>
              <div>
                <span>Arrival: {{arrival}} </span>
              </div>
            </div>
          </li>
        </ul>

        <hr/>

        <ul class="collapse" id="hide{{forloop.counter}}"> <!--Menu desplegable-->

          {% for link in travel %}
            <div class="detail-container" >
              <div class="containerLeft">
                <div>
                  <span>{{link.departure|add_timezone_offset:timezoneOffset}}</span>
                </div>
                <div>
                  {% if link.traveltype.travelname == 'Boat' %}
                    <i class="fa fa-ship fa-3x" aria-hidden="true"></i>
                  {% elif link.traveltype.travelname == 'Plane' %}
                    <i class="fa fa-plane fa-3x" aria-hidden="true"></i>
                  {% else %}
                     <i class="fa fa-bus fa-3x" aria-hidden="true"></i>
                  {% endif %}
                </div>
                <div data-test="SegmentArrivalTime">
                  <div class="false">
                    <span>{{link.departure|add_duration:link.duration|add_timezone_offset:timezoneOffset}}</span>
                  </div>
                </div>
              </div>

              {% if forloop.counter == travel|length %}
                <div class="timeLineDouble"></div>
              {% else %}
                <div class="timeLine"></div>
              {% endif %}

              <div class="containerRight">
                <div class="w-600">
                  <span><b>{{link.origin_city.name}} ({{link.origin_city.country.id}})</b></span>
                </div>
                <div class="containerRight-info">
                  <span style="font-style: italic;"> {{link.travel_agency.name}}</span>
                  <span>U$S {{link.price}} - {{link.duration|parse_minutes}}</span>
                </div>
                <div>
                  {% if forloop.counter == travel|length %}
                    <div class="w-600"><b>{{link.destination_city.name}} ({{link.destination_city.country.id}})</b></div>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </ul>
      </div>
    `;

    $(function(){
      $('#btn').click(function() {
        var request = $.ajax({
          type: "GET",
          url: "/rest/tlc/travels/do_search/?from="+document.getElementById("from").value+"&to="+document.getElementById("to").value+"&date="+document.getElementById("datepicker1").value+"&timezone=3",
          dataType: "json"
        });

        request.done(function(JSON_array) {
          alert(JSON_array["list_travels"][0][0]["departure"]);
          jsonObj = JSON_array["list_travels"][0][0];

          containerAll = document.getElementById('containerAll');
          contact = document.createElement('div');
          contact.id='contact';
          contact.setAttribute('class','contact');
          containerAll.appendChild(contact)

          container = document.createElement('div');
          container.setAttribute('class','container');
          container.id = 'container';
          containerAll.appendChild(container)


          $('#container').append([
            { departure: jsonObj["departure"], arrival: jsonObj["duration"], price: jsonObj["price"] },
            { departure: '/foo', arrival: 'foo.png', price: 'Foo item' },

          ].map(Item).join(''));

        });
      });
    });


  });
</script>

<!-- TotalPrice and TotalDuration Sum -->
<script>
  var i = 0;
  var sum_price = 0;
  {% load filters %}
  {% for travel in list_travels %}
    i++;
    var sum_price = 0;
    {% for link in travel %}
      sum_price = sum_price + {{ link.price }};
    {% endfor %}

    $("#totalPrice_" + i).text(Math.round(sum_price * 100) / 100);
  {% endfor %}
</script>
<!---------------->

<!--TIME ZONE FUNCTION DEFINED PREVIOUSLY -->
<script src="{% static "js/jstz-1.0.4.min.js" %}"></script>
<script language="javascript">
    function getTimezoneOffset() {
      return (new Date()).getTimezoneOffset();
    }
</script>
<!--TIME ZONE FUNCTION DEFINED PREVIOUSLY -->

<script>
$('#searchForm').submit(function(){ //listen for submit event
  $('<input />').attr('type', 'hidden')
      .attr('name', 'timezoneOffset')
      .attr('value', getTimezoneOffset())
      .appendTo('#searchForm');
  return true;
});
</script>

<script>
  $('.panel-heading').click(function(){
      $(this).find('.fa-chevron-down').toggleClass('rotated');
  });
</script>

<!--js for bootstrap working-->
<script src="{% static "js/bootstrap.js" %}"></script>
